<!DOCTYPE html>
<html>
	<head>
		<title>TITLE</title>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.11/lodash.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/html5sortable/0.9.8/html5sortable.min.js"></script>
		<script src="scripts.js"></script>
	</head>
	<body>

		<div id="root">

			<div id="layout"></div>

			<table id="properties">
				<thead>
					<tr>
						<th>Prop</th>
						<th>Value</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>

		</div>

		<style>
			.item {
				position: relative;
				border: 1px solid lightblue;
				padding: 20px;
				border-radius: 4px;
				margin: 2px;
			}
			.item-name {
				display: inline;
				position: absolute;
				top: 0;
				left: 0;
				background-color: lightblue;
			}
			.sortable {
				background-color: yellow;
				height: 20px;
			}
			.sortable-placeholder {
				border: 1px solid darkgreen;
				background-color: lightgreen;
			}
			.sortable-hover {
				background-color: green;
			}
			.list {}
			.list-item {}
			.sublist {}
			.sublist-item {}
		</style>

		<script>
			/* TODO:

			 */

			var props = {
				string : new PropType.String(),
				bool   : new PropType.Bool(),
				int    : new PropType.Int(),
				color  : new PropType.Color(),
				select : new PropType.Select('hello', ['hello', 'world']),
			};


			$(function() {

				// render layout

				var $layout = $("#layout");
				$layout.append(new JasonItem().render());
				// $layout.append(new BodyHeadItem().render())
				$layout.append(new Dropzone().render())

				// render properties

				var $properties = $("#properties");
				propChangeHandler = () => console.log('changed');

				_.each(props, (prop, name) => {
					prop.changed(propChangeHandler);

					$properties
						.find("tbody")
						.append(
							$("<tr/>")
								.append(
									$("<td/>")
										.append(name),
									$("<td/>")
										.append(prop.render()),
								)
						)
				});

				// properties JSON

				console.log(_.map(props, (prop, name) => ({ [name]: prop.value })));

				_.each(sorters, sorter => {
					var s = sortable(`.sortable.${sorter.class}`, sorter.options);
					if (!s.length)
						return;
					console.log(s);
					// $(s).on('sortupdate', e => {
					s[0].addEventListener('sortupdate', e => {
						console.log(e.detail.destination.items);
					});
				});

			});
		</script>

	</body>
</html>
